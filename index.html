<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KulkasAI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script>
        // Konfigurasi Tailwind untuk Dark Mode class-based
        tailwind.config = {
            darkMode: 'class',
        }
    </script>

    <style>
        /* Transisi Warna Global */
        body { 
            transition: background-color 0.5s ease, color 0.5s ease;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
        }
        
        /* Animasi Fluid Blobs */
        .fluid-blob {
            position: fixed;
            width: 600px;
            height: 600px;
            filter: blur(100px);
            z-index: -1;
            border-radius: 50%;
            animation: drift 25s infinite alternate ease-in-out;
        }

        @keyframes drift {
            from { transform: translate(-20%, -20%) scale(1); }
            to { transform: translate(30%, 20%) scale(1.2); }
        }

        /* Glassmorphism Dynamic */
        .glass { 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Mode Styling untuk Output Markdown */
        .dark #recipe-content h1 { color: #f8fafc; }
        .dark #recipe-content h2 { color: #60a5fa; border-color: #1e293b; }
        .dark #recipe-content p, .dark #recipe-content li { color: #cbd5e1; }
        .dark #recipe-content strong { color: #f1f5f9; }

        /* Disable Images */
        #recipe-content img { display: none !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 min-h-screen p-4 md:p-10">
    
    <div class="fluid-blob bg-blue-400/10 dark:bg-blue-600/10 top-0 left-0"></div>
    <div class="fluid-blob bg-purple-400/10 dark:bg-purple-600/10 bottom-0 right-0" style="animation-delay: -5s;"></div>

    <nav class="max-w-4xl mx-auto flex justify-between items-center mb-12 animate__animated animate__fadeIn">
        <div>
            <h1 class="text-3xl font-extrabold tracking-tighter">Kulkas<span class="text-blue-600">AI</span></h1>
            <p id="user-welcome" class="text-xs text-slate-400">Menyambungkan akun...</p>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="toggleDarkMode()" class="glass p-3 rounded-2xl bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 shadow-sm active:scale-90 transition-all">
                <span id="theme-icon-sun" class="hidden dark:block">‚òÄÔ∏è</span>
                <span id="theme-icon-moon" class="block dark:hidden">üåô</span>
            </button>
            <div id="auth-controls" class="flex items-center gap-3"></div>
        </div>
    </nav>

    <main class="max-w-2xl mx-auto">
        <div class="glass p-8 shadow-2xl bg-white/70 dark:bg-slate-900/70 border border-white/40 dark:border-slate-800 animate__animated animate__fadeInUp">
            <textarea id="ingredients" 
                placeholder="Ada apa di kulkas? Misal: Telur, sisa ayam, cabai..." 
                class="w-full bg-transparent border-none text-xl outline-none placeholder:text-slate-400 dark:placeholder:text-slate-600 resize-none h-32"></textarea>
            
            <button onclick="generateRecipe()" id="btn-cook"
                class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-extrabold py-5 rounded-3xl shadow-xl shadow-blue-500/20 transition-all active:scale-[0.97] flex items-center justify-center gap-3">
                <span id="btn-text">Racik Resep AI</span>
                <div id="btn-loader" class="hidden w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            </button>
        </div>

        <div id="recipe-card" class="hidden mt-10 glass p-10 shadow-2xl bg-white/80 dark:bg-slate-900/80 border border-white/50 dark:border-slate-800 animate__animated animate__zoomIn">
            <div id="recipe-content" class="prose prose-slate dark:prose-invert max-w-none"></div>
        </div>
    </main>

    <div id="settings-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-6 hidden">
        <div class="absolute inset-0 bg-slate-950/20 dark:bg-black/60 backdrop-blur-md" onclick="toggleSettings(false)"></div>
        <div class="glass w-full max-w-sm p-10 relative bg-white dark:bg-slate-900 border-none animate__animated animate__fadeInUp">
            <h3 class="text-2xl font-extrabold mb-1">Pengaturan API</h3>
            <p class="text-sm text-slate-500 mb-8">Disimpan di cloud akun Google Anda.</p>
            
            <input type="password" id="api-key-input" placeholder="Masukkan Gemini API Key..." 
                class="w-full p-4 bg-slate-100 dark:bg-slate-800 rounded-2xl mb-6 outline-none ring-blue-500 focus:ring-2 transition-all">
            
            <button onclick="saveApiKeyToCloud()" class="w-full bg-slate-900 dark:bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">Sinkronkan ke Akun</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG: Firebase (Ganti dengan Key Anda)
        const firebaseConfig = {
  apiKey: "AIzaSyC67ZMqywH6Nj_Jm5EjStcT4xq_qRv7yB8",
  authDomain: "kulkas-ai.firebaseapp.com",
  projectId: "kulkas-ai",
  storageBucket: "kulkas-ai.firebasestorage.app",
  messagingSenderId: "364317481294",
  appId: "1:364317481294:web:d2e69c3b82b54b1d0e661f",
  measurementId: "G-G4LH0L728M"
};
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let geminiApiKey = "";

        // --- THEME LOGIC ---
        window.toggleDarkMode = () => {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        };

        // Init Theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // --- AUTH & CLOUD LOGIC ---
        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);
        window.toggleSettings = (show) => document.getElementById('settings-modal').classList.toggle('hidden', !show);

        onAuthStateChanged(auth, async (user) => {
            const controls = document.getElementById('auth-controls');
            const welcome = document.getElementById('user-welcome');
            if (user) {
                currentUser = user;
                welcome.innerText = `Halo, Chef ${user.displayName.split(' ')[0]}!`;
                controls.innerHTML = `
                    <button onclick="toggleSettings(true)" class="w-10 h-10 rounded-2xl glass flex items-center justify-center hover:bg-white dark:hover:bg-slate-700">‚öôÔ∏è</button>
                    <img src="${user.photoURL}" class="w-10 h-10 rounded-2xl border-2 border-blue-500">
                    <button onclick="logout()" class="text-xs font-bold opacity-50 hover:opacity-100">Logout</button>
                `;
                fetchKey(user.uid);
            } else {
                currentUser = null;
                welcome.innerText = "Masuk untuk sinkronisasi cloud.";
                controls.innerHTML = `<button onclick="login()" class="bg-blue-600 text-white px-5 py-3 rounded-2xl font-bold text-sm shadow-lg btn-click">Login</button>`;
            }
        });

        async function fetchKey(uid) {
            const docSnap = await getDoc(doc(db, "users", uid));
            if (docSnap.exists()) geminiApiKey = docSnap.data().geminiKey;
        }

        window.saveApiKeyToCloud = async () => {
            const key = document.getElementById('api-key-input').value.trim();
            if (!currentUser || !key) return;
            await setDoc(doc(db, "users", currentUser.uid), { geminiKey: key });
            geminiApiKey = key;
            toggleSettings(false);
            alert("Selesai! API Key Anda aman di Cloud.");
        };

        // --- GEMINI 2.5 LOGIC ---
        window.generateRecipe = async () => {
            if (!geminiApiKey) return toggleSettings(true);
            const ingredients = document.getElementById('ingredients').value;
            if (!ingredients) return;

            const loader = document.getElementById('btn-loader');
            const btnText = document.getElementById('btn-text');
            const resultCard = document.getElementById('recipe-card');

            loader.classList.remove('hidden');
            btnText.innerText = "Meracik...";
            resultCard.classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Berikan resep masakan enak dari: ${ingredients}. JANGAN sertakan gambar. Format Markdown.` }] }]
                    })
                });
                const data = await response.json();
                document.getElementById('recipe-content').innerHTML = marked.parse(data.candidates[0].content.parts[0].text);
                resultCard.classList.remove('hidden');
            } catch (e) { alert("Pastikan API Key benar."); }
            finally { 
                loader.classList.add('hidden'); 
                btnText.innerText = "Racik Resep AI";
            }
        };
    </script>
</body>
</html>
